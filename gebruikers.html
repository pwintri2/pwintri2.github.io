<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gebruikersbeheer</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#f3f4f6; margin:0; padding:22px;}
    .wrap{max-width:900px; margin:0 auto;}
    .card{background:#fff; padding:18px; border:1px solid #e5e7eb; border-radius:14px; box-shadow:0 10px 25px rgba(0,0,0,.06);}
    h1{margin:0 0 10px; font-size:20px;}
    p{margin:0 0 16px; color:#6b7280;}
    .row{display:grid; grid-template-columns: 1.2fr 0.8fr auto; gap:10px; align-items:end;}
    label{display:block; font-size:12px; color:#6b7280; margin-bottom:6px;}
    input{width:100%; font-size:16px; padding:10px 12px; border:1px solid #d1d5db; border-radius:10px; outline:none;}
    input:focus{border-color:#4f46e5; box-shadow:0 0 0 4px rgba(79,70,229,.12);}
    button{padding:10px 12px; font-size:14px; border:0; border-radius:10px; background:#4f46e5; color:#fff; cursor:pointer;}
    button.secondary{background:#111827;}
    button.danger{background:#ef4444;}
    table{width:100%; border-collapse:collapse; margin-top:16px; overflow:hidden; border-radius:12px; border:1px solid #e5e7eb;}
    th, td{padding:10px 12px; border-bottom:1px solid #e5e7eb; text-align:left;}
    th{background:#f9fafb; font-size:12px; letter-spacing:.02em; color:#6b7280; text-transform:uppercase;}
    td input{font-size:14px; padding:8px 10px;}
    .actions{display:flex; gap:8px; justify-content:flex-end;}
    .hint{margin-top:12px; color:#9ca3af; font-size:12px;}
    .top-actions{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;}
    a{color:#4f46e5; text-decoration:none;}
    .ok{color:#10b981; font-size:13px; min-height:1.2em; margin-top:10px;}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Gebruikersbeheer</h1>
    <p>Voeg gebruikers toe met een pincode. Dit wordt opgeslagen in <b>jouw browser</b> (localStorage).</p>

    <div class="row">
      <div>
        <label>Naam</label>
        <input id="name" placeholder="Bijv. Anne" />
      </div>
      <div>
        <label>Pincode</label>
        <input id="pin" inputmode="numeric" placeholder="Bijv. 4829" />
      </div>
      <div>
        <button id="add">Toevoegen</button>
      </div>
    </div>

    <div class="top-actions">
      <button class="secondary" id="gen">Genereer pincode</button>
      <button class="secondary" id="export">Export (JSON)</button>
      <button class="secondary" id="importBtn">Import (JSON)</button>
      <input id="importFile" type="file" accept="application/json" style="display:none" />
      <a href="index.html" style="align-self:center">← terug naar login</a>
    </div>

    <div id="ok" class="ok"></div>

    <table>
      <thead>
        <tr>
          <th style="width:45%">Naam</th>
          <th style="width:25%">Pincode</th>
          <th style="width:30%; text-align:right;">Acties</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="hint">
      Tip: wil je dit op meerdere apparaten gebruiken, dan moet je export/import doen (of een echte server/back-end gebruiken).
    </div>
  </div>
</div>

<script>
(function(){
  const USERS_KEY = "wwp_users";
  const $name = document.getElementById("name");
  const $pin = document.getElementById("pin");
  const $tbody = document.getElementById("tbody");
  const $ok = document.getElementById("ok");

  function showOk(text){
    $ok.textContent = text || "";
    if(text) setTimeout(()=>{ $ok.textContent = ""; }, 2500);
  }

  function load(){
    try{
      const raw = localStorage.getItem(USERS_KEY);
      if(!raw) return [{ name:"Philip", pin:"1234" }];
      const list = JSON.parse(raw);
      if(!Array.isArray(list) || list.length === 0) return [{ name:"Philip", pin:"1234" }];
      return list;
    }catch(e){
      return [{ name:"Philip", pin:"1234" }];
    }
  }

  function save(list){
    localStorage.setItem(USERS_KEY, JSON.stringify(list));
  }

  function render(){
    const list = load();
    $tbody.innerHTML = "";
    list.forEach((u, idx)=>{
      const tr = document.createElement("tr");

      const tdName = document.createElement("td");
      const inName = document.createElement("input");
      inName.value = u.name ?? "";
      inName.addEventListener("input", ()=>{
        const cur = load();
        cur[idx].name = inName.value;
        save(cur);
      });
      tdName.appendChild(inName);

      const tdPin = document.createElement("td");
      const inPin = document.createElement("input");
      inPin.value = u.pin ?? "";
      inPin.inputMode = "numeric";
      inPin.addEventListener("input", ()=>{
        const cur = load();
        cur[idx].pin = inPin.value;
        save(cur);
      });
      tdPin.appendChild(inPin);

      const tdAct = document.createElement("td");
      tdAct.style.textAlign = "right";
      const wrap = document.createElement("div");
      wrap.className = "actions";

      const del = document.createElement("button");
      del.className = "danger";
      del.textContent = "Verwijder";
      del.addEventListener("click", ()=>{
        const cur = load();
        cur.splice(idx,1);
        save(cur);
        render();
        showOk("Gebruiker verwijderd.");
      });

      wrap.appendChild(del);
      tdAct.appendChild(wrap);

      tr.appendChild(tdName);
      tr.appendChild(tdPin);
      tr.appendChild(tdAct);

      $tbody.appendChild(tr);
    });
  }

  function addUser(){
    const name = ($name.value || "").trim();
    const pin = ($pin.value || "").trim();
    if(!name || !pin){
      alert("Vul naam én pincode in.");
      return;
    }
    const list = load();

    // voorkom dubbele pincode
    if(list.some(u => String(u.pin) === String(pin))){
      alert("Deze pincode bestaat al. Kies een andere.");
      return;
    }

    list.push({ name, pin });
    save(list);
    $name.value = "";
    $pin.value = "";
    render();
    showOk("Gebruiker toegevoegd.");
  }

  function genPin(){
    // 4-cijferige pincode, niet beginnend met 0
    const pin = String(Math.floor(1000 + Math.random()*9000));
    $pin.value = pin;
    $pin.focus();
    showOk("Pincode gegenereerd.");
  }

  function exportJson(){
    const data = JSON.stringify(load(), null, 2);
    const blob = new Blob([data], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "gebruikers.json";
    a.click();
    URL.revokeObjectURL(url);
  }

  function importJson(file){
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const list = JSON.parse(String(reader.result || "[]"));
        if(!Array.isArray(list)) throw new Error("Geen lijst");
        // simpele validatie
        const cleaned = list
          .filter(x => x && typeof x === "object")
          .map(x => ({ name: String(x.name||"").trim(), pin: String(x.pin||"").trim() }))
          .filter(x => x.name && x.pin);

        if(cleaned.length === 0) throw new Error("Leeg/ongeldig");
        save(cleaned);
        render();
        showOk("Import gelukt.");
      }catch(e){
        alert("Import mislukt: ongeldige JSON.");
      }
    };
    reader.readAsText(file);
  }

  document.getElementById("add").addEventListener("click", addUser);
  document.getElementById("gen").addEventListener("click", genPin);
  document.getElementById("export").addEventListener("click", exportJson);

  const importFile = document.getElementById("importFile");
  document.getElementById("importBtn").addEventListener("click", ()=> importFile.click());
  importFile.addEventListener("change", (e)=>{
    const f = e.target.files && e.target.files[0];
    if(f) importJson(f);
    importFile.value = "";
  });

  // init
  render();
})();
</script>
</body>
</html>
